!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).cookieManager=t()}(this,(function(){"use strict";var e=function(){return e=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},e.apply(this,arguments)};function t(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var n=function(){function t(t){var n,o;this.defaultConfig={userPreferences:{cookieName:"cookie-preferences",cookieExpiry:365,cookieSecure:0},preferencesForm:{class:"cookie-preferences-form"},cookieBanner:{class:"cookie-banner",showWithPreferencesForm:0,actions:[{name:"accept",buttonClass:"cookie-banner-accept-button",confirmationClass:"cookie-banner-accept-message",consent:1},{name:"reject",buttonClass:"cookie-banner-reject-button",confirmationClass:"cookie-banner-reject-message",consent:0},{name:"hide",buttonClass:"cookie-banner-hide-button"}]},cookieManifest:[],additionalOptions:{deleteUndefinedCookies:1,defaultConsent:0}},this.activeConfig={},t?(this.activeConfig.userPreferences=e(e({},this.defaultConfig.userPreferences),t.userPreferences),this.activeConfig.preferencesForm=null!==(n=t.preferencesForm)&&void 0!==n?n:this.defaultConfig.preferencesForm,this.activeConfig.cookieBanner=e(e({},this.defaultConfig.cookieBanner),t.cookieBanner),this.activeConfig.cookieManifest=null!==(o=t.cookieManifest)&&void 0!==o?o:this.defaultConfig.cookieManifest,this.activeConfig.additionalOptions=e(e({},this.defaultConfig.additionalOptions),t.additionalOptions)):this.activeConfig=this.defaultConfig}return t.prototype.getUserPreferencesCookieName=function(){return this.activeConfig.userPreferences.cookieName},t.prototype.getUserPreferencesCookieExpiry=function(){return this.activeConfig.userPreferences.cookieExpiry},t.prototype.getUserPreferencesCookieSecure=function(){return this.activeConfig.userPreferences.cookieSecure},t.prototype.getPreferencesFormConfiguration=function(){return this.activeConfig.preferencesForm},t.prototype.getCookieBannerConfiguration=function(){return this.activeConfig.cookieBanner},t.prototype.getCookieManifest=function(){return this.activeConfig.cookieManifest},t.prototype.getDefaultConsent=function(){return this.activeConfig.additionalOptions.defaultConsent},t.prototype.shouldDeleteUncategorized=function(){return this.activeConfig.additionalOptions.deleteUndefinedCookies},t}(),o=function(){function e(e,t,n,o){void 0===t&&(t=[]),void 0===n&&(n=1),void 0===o&&(o="startsWith"),this.name=e,this.cookies=t,this.optional=n,this.matchBy=o}return e.prototype.getName=function(){return this.name},e.prototype.getCookies=function(){return this.cookies},e.prototype.getMatchBy=function(){return this.matchBy},e.prototype.isOptional=function(){return this.optional},e}(),r=function(){function e(e){this.config=e}return e.prototype.getCategoryByCookieName=function(t){if(t===this.config.getUserPreferencesCookieName())return new o("__cookie-manager",[],0);var n=this.getCategories().filter((function(e){return e.getCookies().some((function(n){switch(e.getMatchBy()){case"startsWith":return t.startsWith(n);case"exact":return t===n;case"includes":return t.includes(n);default:return 0}}))}))[0];return null!=n?n:new o(e.DEFAULTS.UNDEFINED_CATEGORY_NAME)},e.prototype.getCategories=function(){return this.config.getCookieManifest().filter((function(e){return e.categoryName&&Array.isArray(e.cookies)?1:(console.debug("Malformed cookie manifest category, ignoring."),0)})).map((function(e){return new o(e.categoryName,e.cookies,e.optional,e.matchBy)}))},e.DEFAULTS={UNDEFINED_CATEGORY_NAME:"un-categorized"},e}(),i=function(){function e(e,t){this.name=e,this.value=t}return e.prototype.getName=function(){return this.name},e.prototype.getValue=function(){return this.value},e}(),s=function(){function e(e,t,n){this.config=e,this.manifestHandler=t,this.userPreferences=n}return e.prototype.processCookies=function(){this.config.shouldDeleteUncategorized()&&this._processUnCategorizedCookies(),this._processNonConsentedCookies()},e.prototype._processNonConsentedCookies=function(){var t=this;console.debug("Deleting non-consented cookies"),e.getAllCookies().filter((function(e){var n=t.manifestHandler.getCategoryByCookieName(e.getName());return n.getName()!==r.DEFAULTS.UNDEFINED_CATEGORY_NAME&&n.isOptional()&&!t.userPreferences.getPreferences()[n.getName()]})).forEach((function(t){return e.deleteCookie(t)}))},e.prototype._processUnCategorizedCookies=function(){var t=this;console.debug("Deleting non-categorized cookies"),e.getAllCookies().filter((function(e){return t.manifestHandler.getCategoryByCookieName(e.getName()).getName()===r.DEFAULTS.UNDEFINED_CATEGORY_NAME})).forEach((function(t){return e.deleteCookie(t)}))},e.getAllCookies=function(){return decodeURIComponent(document.cookie).split(";").map((function(e){return e.trim()})).filter((function(e){return e.length})).map((function(e){var t=e.split(/=(.*)/).map((function(e){return e.trim()}));return new i(t[0],t[1])}))},e.getCookie=function(t){return e.getAllCookies().filter((function(e){return e.getName()===t}))[0]},e.saveCookie=function(e,t,n){var o=new Date;o.setDate(o.getDate()+t);var r=e.getName()+"=";r+="object"==typeof e.getValue()?JSON.stringify(e.getValue()):e.getValue(),r+=t?";expires="+o.toUTCString():"",r+=n?";secure":"",r+=";path=/;",document.cookie=r,console.debug("Saved '".concat(e.getName(),"' cookie"))},e.deleteCookie=function(e){console.debug("Deleting cookie: "+e.getName());var t=window.location.hostname,n=t.substring(t.indexOf(".")),o=new Date(-1).toUTCString();[t,"."+t,n,"."+n].forEach((function(t){document.cookie=e.getName()+"=;expires="+o+";domain="+t+";path=/;"}))},e}(),c=function(){function e(){}return e.on=function(t,n){if("string"==typeof t){if("function"==typeof n){t=t.toLowerCase();var o=Math.random().toString(16).slice(2);return e._handlerMap.has(t)||e._handlerMap.set(t,new Map),e._handlerMap.get(t).set(o,n),{type:t,token:o}}console.error("No callback function provided")}else console.error("Event not provided")},e.off=function(t){var n,o;try{n=t.type.toLowerCase(),o=t.token}catch(e){return void console.error("Missing or malformed event token provided")}e._handlerMap.has(n)&&e._handlerMap.get(n).delete(o)},e.emit=function(t,n){t=t.toLowerCase(),console.debug("Event fired: "+t),e._handlerMap.has(t)&&e._handlerMap.get(t).forEach((function(e){return e(n)}))},e._handlerMap=new Map,e}(),a=function(){function e(e,t){this.config=e,this.manifestHandler=t}return e.prototype.processPreferences=function(){var e=this.getPreferenceCookie();this.setPreferences(e?this._loadPreferencesFromCookie():this._loadPreferenceDefaults())},e.prototype.getPreferences=function(){return this.preferences?this.preferences:(console.error("User preferences not loaded/set, call .processPreferences() first"),{})},e.prototype.setPreferences=function(e){console.debug("Setting preferences to: "+JSON.stringify(e)),this.preferences=e,c.emit("UserPreferencesSet",e)},e.prototype.getPreferenceCookie=function(){return s.getCookie(this.config.getUserPreferencesCookieName())},e.prototype.savePreferencesToCookie=function(){var e={},t=this.getPreferences();Object.keys(t).forEach((function(n){e[n]=t[n]?"on":"off"}));var n=new i(this.config.getUserPreferencesCookieName(),e);s.saveCookie(n,this.config.getUserPreferencesCookieExpiry(),this.config.getUserPreferencesCookieSecure()),c.emit("UserPreferencesSaved",e)},e.prototype._loadPreferencesFromCookie=function(){var e,t=this.getPreferenceCookie();try{console.debug("Loading preferences from cookie"),e=JSON.parse(t.getValue())}catch(e){return console.error('Unable to parse user preference cookie "'.concat(t.getName(),'" as JSON.')),s.deleteCookie(t),this._loadPreferenceDefaults()}if("object"!=typeof e)return console.debug("User preferences cookie is malformed, deleting old user preferences cookie."),s.deleteCookie(t),this._loadPreferenceDefaults();if(this.manifestHandler.getCategories().filter((function(e){return e.isOptional()})).some((function(t){return!Object.keys(e).includes(t.getName())})))return console.debug("User preferences cookie is missing categories, deleting old user preferences cookie."),s.deleteCookie(t),this._loadPreferenceDefaults();var n={};return Object.keys(e).forEach((function(t){n[t]="on"===e[t]})),c.emit("UserPreferencesLoaded",e),n},e.prototype._loadPreferenceDefaults=function(){var e=this;console.debug("Loading preferences from defaults");var t={},n={};return this.manifestHandler.getCategories().filter((function(e){return e.isOptional()})).forEach((function(o){t[o.getName()]=e.config.getDefaultConsent(),n[o.getName()]=e.config.getDefaultConsent()?"on":"off"})),c.emit("UserPreferencesLoaded",n),t},e}(),f=function(){function e(e,t,n){this.config=e,this.userPreferencesHandler=t,this.cookieHandler=n}return e.prototype.init=function(){var e=this;if(!this.userPreferencesHandler.getPreferenceCookie())return"loading"===document.readyState?(console.debug("DOM is not ready; adding event to bind to banner when ready."),void document.addEventListener("DOMContentLoaded",(function(){return e.init()}))):void(this._getBannerNode()&&(document.getElementsByClassName(this.config.getPreferencesFormConfiguration().class)[0]&&!this.config.getCookieBannerConfiguration().showWithPreferencesForm||(this._setupEventListeners(),this._getBannerNode().hidden=0,c.emit("CookieBannerInitialized"))))},e.prototype._setupEventListeners=function(){var e,n=this;((null===(e=this.config.getCookieBannerConfiguration())||void 0===e?void 0:e.actions)||[]).forEach((function(e){var o,r;try{for(var i=t(n._getBannerNode().querySelectorAll("."+e.buttonClass)),s=i.next();!s.done;s=i.next())s.value.addEventListener("click",(function(t){n._clickEventHandler(t,e.name,e.confirmationClass,e.consent)}))}catch(e){o={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}}))},e.prototype._clickEventHandler=function(e,n,o,r){var i,s;if(e.preventDefault(),c.emit("CookieBannerAction",n),o)try{for(var a=t(this._getBannerNode().children),f=a.next();!f.done;f=a.next()){var u=f.value;u.hidden=!u.classList.contains(o)}}catch(e){i={error:e}}finally{try{f&&!f.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}else this._getBannerNode().hidden=1;if(void 0!==r){var l=this.userPreferencesHandler.getPreferences();"boolean"==typeof r&&Object.keys(l).forEach((function(e){l[e]=r})),Array.isArray(r)&&r.forEach((function(e){l[e]=1})),this._updatePreferences(l)}},e.prototype._updatePreferences=function(e){this.userPreferencesHandler.setPreferences(e),this.userPreferencesHandler.savePreferencesToCookie(),this.cookieHandler.processCookies()},e.prototype._getBannerNode=function(){var e;return document.querySelector("."+(null===(e=this.config.getCookieBannerConfiguration())||void 0===e?void 0:e.class))},e}(),u=function(){function e(e,t,n){this.config=e,this.userPreferencesHandler=t,this.cookieHandler=n}return e.prototype.init=function(){var e=this;if("loading"===document.readyState)return console.debug("DOM is not ready; adding event to bind to preference form when ready."),void document.addEventListener("DOMContentLoaded",(function(){return e.init()}));this._getPreferencesForm()&&(this._setupEventListeners(),this._configureFormRadios(),c.emit("PreferenceFormInitialized"))},e.prototype._getPreferencesForm=function(){return document.getElementsByClassName(this.config.getPreferencesFormConfiguration().class)[0]},e.prototype._setupEventListeners=function(){var e=this;this._getPreferencesForm().addEventListener("submit",(function(t){return e._submitEventHandler(t)}))},e.prototype._submitEventHandler=function(e){var n,o;e.preventDefault();var r={};try{for(var i=t(e.target.querySelectorAll('input[type="radio"]:checked')),s=i.next();!s.done;s=i.next()){var a=s.value,f=a.getAttribute("name"),u=a.getAttribute("value");r[f]="on"===u}}catch(e){n={error:e}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}c.emit("PreferenceFormSubmitted",r),this._updatePreferences(r)},e.prototype._updatePreferences=function(e){this.userPreferencesHandler.setPreferences(e),this.userPreferencesHandler.savePreferencesToCookie(),this.cookieHandler.processCookies()},e.prototype._configureFormRadios=function(){var e=this.userPreferencesHandler.getPreferences();for(var t in e){var n=e[t]?"on":"off",o=this._getPreferencesForm().querySelector("input[name=".concat(t,"][value=").concat(n,"]"));o&&(o.checked=1)}},e}();return{init:function(e){console.debug("CookieManager initializing...");var t=new n(e),o=new r(t),i=new a(t,o),l=new s(t,o,i);i.processPreferences(),Object.keys(t.getCookieBannerConfiguration()).length&&new f(t,i,l).init(),Object.keys(t.getPreferencesFormConfiguration()).length&&new u(t,i,l).init(),c.emit("CookieManagerLoaded"),l.processCookies()},on:c.on,off:c.off}}));
